<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>⎔ Permohonan · {{ event.title }}</title>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Font: Inter — dashboard standard -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300;14..32,400;14..32,500;14..32,600;14..32,700;14..32,800&display=swap" rel="stylesheet">

    <style>
        /* ---------------------------------------------------------------
           NEUROMORPHIC DEEP — DARK INSET · SIGNAL LOCKED
           
           > ENHANCED: ALL INPUTS NOW HAVE THE DARK, HIGH-CONTRAST INSET
             APPEARANCE OF THE 'BILANGAN TANGGUNGAN' FIELD.
             
             - Darker background (gray-50 → gray-100)
             - Stronger, more pronounced inset shadows
             - Higher contrast between highlight and shadow
             - Deeper recession effect
        --------------------------------------------------------------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Monochrome strict — enhanced contrast */
            --black: #000000;
            --white: #ffffff;
            --gray-50: #fafafa;
            --gray-100: #f0f0f0;      /* Slightly darker base */
            --gray-200: #e0e0e0;
            --gray-300: #d0d0d0;
            --gray-400: #a0a0a0;
            --gray-500: #707070;
            --gray-600: #505050;
            --gray-700: #404040;
            --gray-800: #2d2d2d;
            --gray-900: #1a1a1a;
            
            /* ===== DARK, HIGH-CONTRAST INSET — like Bilangan Tanggungan ===== */
            --neu-inset-dark: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.2),
                inset -4px -4px 10px rgba(255, 255, 255, 0.9);
            
            --neu-inset-darker: 
                inset 8px 8px 16px rgba(0, 0, 0, 0.25),
                inset -6px -6px 12px rgba(255, 255, 255, 0.95);
            
            --neu-inset-deep: 
                inset 8px 8px 16px rgba(0, 0, 0, 0.18),
                inset -6px -6px 12px rgba(255, 255, 255, 0.9);
            
            /* Raised shadows — for cards and headers */
            --neu-raised-deep: 
                16px 16px 28px rgba(0, 0, 0, 0.12),
                -14px -14px 28px rgba(255, 255, 255, 0.9);
            
            /* Radius */
            --radius-md: 20px;
            --radius-lg: 28px;
            --radius-xl: 32px;
            --radius-full: 9999px;
            
            --transition: 0.2s cubic-bezier(0.2, 0, 0, 1);
        }

        body {
            background: var(--gray-100);
            background-image: 
                linear-gradient(to right, rgba(0,0,0,0.04) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(0,0,0,0.04) 1px, transparent 1px);
            background-size: 24px 24px;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--gray-900);
            line-height: 1.5;
            min-height: 100vh;
            padding: 0 0 24px 0;
            -webkit-font-smoothing: antialiased;
            position: relative;
        }

        /* ===== WOW EFFECTS ===== */
        .static-noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="static"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"/><feColorMatrix type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.03 0"/></filter><rect width="200" height="200" filter="url(%23static)" opacity="0.025"/></svg>');
            opacity: 0.15;
            pointer-events: none;
            z-index: 9998;
            animation: staticShift 0.5s infinite;
        }

        @keyframes staticShift {
            0% { background-position: 0 0; }
            100% { background-position: 20px 20px; }
        }

        .crt-scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.08) 3px,
                transparent 4px
            );
            pointer-events: none;
            z-index: 9999;
            opacity: 0.1;
        }

        /* ===== SIGNAL BARS ===== */
        .signal-bar-mini {
            display: inline-flex;
            align-items: flex-end;
            gap: 3px;
            height: 20px;
        }
        .signal-bar-mini span {
            width: 4px;
            background: var(--black);
            height: 8px;
            animation: signalPulse 1.2s infinite alternate;
            opacity: 0.8;
            border-radius: 1px;
        }
        .signal-bar-mini span:nth-child(1) { height: 8px; animation-delay: 0s; }
        .signal-bar-mini span:nth-child(2) { height: 12px; animation-delay: 0.2s; }
        .signal-bar-mini span:nth-child(3) { height: 18px; animation-delay: 0.4s; }
        .signal-bar-mini span:nth-child(4) { height: 14px; animation-delay: 0.1s; }
        .signal-bar-mini span:nth-child(5) { height: 10px; animation-delay: 0.3s; }
        @keyframes signalPulse {
            0% { opacity: 0.4; height: 6px; }
            100% { opacity: 1; height: 20px; }
        }

        /* ===== FREQUENCY SCAN SWEEP ===== */
        .scan-sweep {
            position: relative;
            overflow: hidden;
        }
        .scan-sweep::after {
            content: '';
            position: absolute;
            top: 0;
            left: -30%;
            width: 40%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.12), transparent);
            animation: sweep 3s ease-in-out infinite;
            pointer-events: none;
        }
        @keyframes sweep {
            0% { left: -40%; }
            100% { left: 140%; }
        }

        /* ===== TRANSMISSION RIPPLE ===== */
        .transmission-ripple {
            position: relative;
        }
        .transmission-ripple::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            border: 1px solid var(--black);
            border-radius: inherit;
            transform: translate(-50%, -50%) scale(0.9);
            opacity: 0;
            animation: ripple 2s ease-out infinite;
            pointer-events: none;
        }
        @keyframes ripple {
            0% {
                transform: translate(-50%, -50%) scale(0.9);
                opacity: 0.4;
                border-width: 1px;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.6);
                opacity: 0;
                border-width: 0.5px;
            }
        }

        /* ----- HEADER — RAISED ----- */
        .header-monochrome {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 28px 24px 32px;
            margin-bottom: 24px;
            box-shadow: var(--neu-raised-deep);
            position: relative;
            z-index: 10;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .logo-pair-monochrome {
            display: flex;
            align-items: center;
            gap: 16px;
            background: var(--gray-100);
            padding: 10px 20px;
            border-radius: var(--radius-full);
            border: 1px solid var(--gray-200);
            box-shadow: var(--neu-inset-dark);
        }

        .logo-pair-monochrome img {
            height: 36px;
            width: auto;
            object-fit: contain;
            filter: brightness(0.95) contrast(1.2);
        }

        .divider-monochrome {
            width: 1px;
            height: 28px;
            background: var(--gray-400);
        }

        .badge-monochrome {
            background: var(--black);
            color: var(--white);
            padding: 8px 22px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            box-shadow: var(--neu-raised-deep);
            border: 1px solid var(--gray-700);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .headline-monochrome {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: var(--black);
            margin-bottom: 4px;
            line-height: 1.1;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .subhead-monochrome {
            font-size: 0.75rem;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .event-title-monochrome {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--gray-900);
            margin: 8px 0 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--gray-300);
        }

        .event-meta-monochrome {
            display: flex;
            gap: 28px;
            color: var(--gray-600);
            font-size: 0.85rem;
        }

        .meta-item-monochrome {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .meta-item-monochrome i {
            color: var(--black);
        }

        /* ----- CARDS — RAISED, HIGH CONTRAST ----- */
        .card-monochrome {
            background: var(--white);
            border-radius: var(--radius-lg);
            margin: 0 20px 28px 20px;
            padding: 28px 24px;
            border: none;
            box-shadow: var(--neu-raised-deep);
            transition: var(--transition);
            position: relative;
        }

        .card-monochrome:active {
            box-shadow: var(--neu-inset-dark);
            transform: scale(0.998);
        }

        .section-header-monochrome {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 28px;
            border-bottom: 1px solid var(--gray-300);
            padding-bottom: 16px;
        }

        .section-icon-monochrome {
            width: 52px;
            height: 52px;
            background: var(--gray-100);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            color: var(--black);
            border: none;
            box-shadow: var(--neu-inset-dark);
        }

        .section-title-monochrome {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--black);
            letter-spacing: -0.01em;
        }

        .section-desc-monochrome {
            font-size: 0.7rem;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 500;
            margin-top: 2px;
        }

        /* ===== FORM FIELDS — DARK, HIGH-CONTRAST INSET (like Bilangan Tanggungan) ===== */
        .field-monochrome {
            margin-bottom: 22px;
            position: relative;
        }

        .field-monochrome label {
            display: block;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            margin-left: 6px;
        }

        .field-monochrome input,
        .field-monochrome select,
        .field-monochrome textarea {
            width: 100%;
            padding: 16px 18px;
            background: var(--gray-100);  /* Darker background for deeper recession */
            border: none;
            border-radius: 22px;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            color: var(--gray-900);
            font-weight: 500;
            transition: var(--transition);
            
            /* === DARK, HIGH-CONTRAST INSET — exactly like .dependants-monochrome input === */
            box-shadow: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.2),
                inset -4px -4px 10px rgba(255, 255, 255, 0.9);
            
            /* Slight inner border definition */
            border: 1px solid rgba(0,0,0,0.02);
        }

        .field-monochrome input:focus,
        .field-monochrome select:focus,
        .field-monochrome textarea:focus {
            outline: none;
            /* Even darker, more pronounced on focus */
            box-shadow: 
                inset 8px 8px 16px rgba(0, 0, 0, 0.25),
                inset -6px -6px 12px rgba(255, 255, 255, 0.95),
                0 0 0 3px rgba(0,0,0,0.02);
            background: var(--gray-50);  /* Slightly lighter on focus for contrast */
        }

        .field-monochrome input::placeholder {
            color: var(--gray-500);
            font-weight: 400;
            opacity: 0.8;
        }

        /* Select styling — consistent dark inset */
        select.field-monochrome, 
        .field-monochrome select {
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>');
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 16px;
        }

        /* ----- PROGRAMME GRID — DARK INSET TILES ----- */
        .programme-grid-monochrome {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
            margin-top: 16px;
        }

        .programme-tile-monochrome {
            position: relative;
        }

        .programme-tile-monochrome input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .programme-tile-monochrome label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            border: none;
            border-radius: 22px;
            padding: 22px 8px;
            font-weight: 600;
            color: var(--gray-800);
            transition: var(--transition);
            
            /* DARK INSET — matching input fields */
            box-shadow: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.2),
                inset -4px -4px 10px rgba(255, 255, 255, 0.9);
            
            min-height: 120px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .programme-tile-monochrome label i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--gray-600);
            transition: 0.2s;
        }

        .programme-tile-monochrome input[type="radio"]:checked + label {
            background: var(--black);
            color: var(--white);
            box-shadow: 0 16px 32px -8px rgba(0,0,0,0.6), inset 0 2px 4px rgba(255,255,255,0.3);
            border: 1px solid var(--gray-700);
        }

        .programme-tile-monochrome input[type="radio"]:checked + label i {
            color: var(--white);
        }

        .programme-tile-monochrome label::after {
            content: '';
            position: absolute;
            top: 0;
            left: -50%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.08), transparent);
            animation: tileScan 4s ease-in-out infinite;
            pointer-events: none;
            opacity: 0;
        }

        .programme-tile-monochrome:hover label::after {
            opacity: 1;
        }

        @keyframes tileScan {
            0% { left: -50%; }
            100% { left: 150%; }
        }

        /* ----- DEPENDANTS — DARK INSET (REFERENCE STYLE) ----- */
        .dependants-monochrome {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--gray-100);
            padding: 12px 20px;
            border-radius: 60px;
            border: none;
            margin-top: 12px;
            box-shadow: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.2),
                inset -4px -4px 10px rgba(255, 255, 255, 0.9);
        }

        .dependants-monochrome span {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .dependants-monochrome span i {
            color: var(--gray-700);
        }

        .dependants-monochrome input {
            width: 90px;
            text-align: center;
            background: var(--gray-100);
            border: none;
            border-radius: 40px;
            padding: 12px 8px;
            font-weight: 700;
            font-size: 1rem;
            color: var(--black);
            
            /* DARK INSET — high contrast */
            box-shadow: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.2),
                inset -4px -4px 10px rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0,0,0,0.02);
        }

        .dependants-monochrome input:focus {
            outline: none;
            box-shadow: 
                inset 8px 8px 16px rgba(0, 0, 0, 0.25),
                inset -6px -6px 12px rgba(255, 255, 255, 0.95),
                0 0 0 3px rgba(0,0,0,0.02);
            background: var(--gray-50);
        }

        /* ----- INTEREST CARDS — DARK INSET (harmonized) ----- */
        .interest-stack-monochrome {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .interest-card-monochrome {
            background: var(--gray-100);
            border-radius: 24px;
            padding: 20px;
            border: none;
            box-shadow: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.2),
                inset -4px -4px 10px rgba(255, 255, 255, 0.9);
        }

        .interest-card-monochrome h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 16px;
        }

        .interest-card-monochrome h4 i {
            color: var(--gray-700);
        }

        .interest-card-monochrome textarea {
            width: 100%;
            background: var(--gray-100);
            border: none;
            border-radius: 20px;
            padding: 16px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            resize: vertical;
            color: var(--gray-900);
            font-weight: 500;
            
            /* DARK INSET — consistent with all inputs */
            box-shadow: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.2),
                inset -4px -4px 10px rgba(255, 255, 255, 0.9);
            transition: var(--transition);
            border: 1px solid rgba(0,0,0,0.02);
        }

        .interest-card-monochrome textarea:focus {
            outline: none;
            box-shadow: 
                inset 8px 8px 16px rgba(0, 0, 0, 0.25),
                inset -6px -6px 12px rgba(255, 255, 255, 0.95),
                0 0 0 3px rgba(0,0,0,0.02);
            background: var(--gray-50);
        }

        .interest-card-monochrome textarea::placeholder {
            color: var(--gray-500);
            font-weight: 400;
        }

        /* ----- CTA BUTTON — DARK RAISED (contrast) ----- */
        .btn-monochrome {
            background: var(--black);
            color: var(--white);
            border: none;
            font-weight: 700;
            font-size: 1.1rem;
            padding: 20px 32px;
            width: 100%;
            border-radius: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            letter-spacing: 1px;
            box-shadow: var(--neu-raised-deep);
            transition: var(--transition);
            margin: 16px 0 8px;
            border: 1px solid var(--gray-700);
            position: relative;
            overflow: hidden;
        }

        .btn-monochrome::after {
            content: '';
            position: absolute;
            top: 0;
            left: -30%;
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: btnScan 3s ease-in-out infinite;
        }

        @keyframes btnScan {
            0% { left: -30%; }
            100% { left: 130%; }
        }

        .btn-monochrome:active {
            transform: scale(0.98);
            box-shadow: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.3),
                inset -4px -4px 10px rgba(255, 255, 255, 0.2);
            background: var(--gray-900);
        }

        .btn-monochrome i {
            font-size: 1.2rem;
        }

        /* ===== VALIDATION — DARK INSET + BLACK OUTLINE ===== */
        .is-invalid {
            border: none !important;
            box-shadow: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.2),
                inset -4px -4px 10px rgba(255, 255, 255, 0.9),
                0 0 0 2px var(--black) !important;
        }

        .programme-tile-monochrome .is-invalid-label {
            box-shadow: 
                inset 6px 6px 12px rgba(0,0,0,0.2),
                inset -4px -4px 10px rgba(255,255,255,0.9),
                0 0 0 2px #000000 !important;
        }

        .brand-monochrome {
            text-align: center;
            padding: 28px 20px 12px;
            color: var(--gray-500);
            font-size: 0.65rem;
            letter-spacing: 4px;
            text-transform: uppercase;
            border-top: 1px solid var(--gray-300);
            margin-top: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .error-message {
            background: var(--white);
            border: 1px solid var(--black);
            border-radius: 60px;
            padding: 16px;
            color: var(--black);
            text-align: center;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 0 20px 20px;
            box-shadow: 
                inset 6px 6px 12px rgba(0, 0, 0, 0.1),
                inset -4px -4px 10px rgba(255, 255, 255, 0.9);
        }

        .frequency-lock {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <!-- WOW EFFECTS -->
    <div class="static-noise"></div>
    <div class="crt-scanlines"></div>

    <!-- HEADER — RAISED -->
    <div class="header-monochrome scan-sweep">
        <div class="header-top">
            <div class="logo-pair-monochrome">
                <img src="/static/images/SES_LOGO_RENEW.png" alt="SES" onerror="this.style.display='none';">
                <span class="divider-monochrome"></span>
                <img src="/static/images/upkb.png" alt="UPKB">
            </div>
            <div class="frequency-lock">
                <div class="signal-bar-mini">
                    <span></span><span></span><span></span><span></span><span></span>
                </div>
                <span class="badge-monochrome">
                    <i class="bi bi-calendar3"></i> {{ event.date|date:"d M Y" }}
                </span>
            </div>
        </div>

        <h1 class="headline-monochrome">
            Borang Permohonan
            <span style="font-size: 0.9rem; font-weight: 400; color: var(--gray-500); font-family: monospace; margin-left: auto;">RX·LOCK</span>
        </h1>
        <div class="subhead-monochrome">Programme Application</div>

        <div class="event-title-monochrome">{{ event.title }}</div>

        <div class="event-meta-monochrome">
            <span class="meta-item-monochrome"><i class="bi bi-pin"></i> {{ event.venue }}</span>
            <span class="meta-item-monochrome"><i class="bi bi-clock"></i> {{ event.start_time|time:"g:i A" }} – {{ event.end_time|time:"g:i A" }}</span>
        </div>
    </div>

    <!-- MAIN FORM — EVERY INPUT NOW HAS DARK, HIGH-CONTRAST INSET (LIKE BILANGAN TANGGUNGAN) -->
    <form id="dataEntryForm" method="POST" action="{% url 'check_in' event.id event.check_in_token %}" novalidate>
        {% csrf_token %}

        <!-- SECTION 1: Maklumat Pemohon — DARK INSET FIELDS -->
        <div class="card-monochrome scan-sweep transmission-ripple">
            <div class="section-header-monochrome">
                <span class="section-icon-monochrome"><i class="bi bi-person-badge"></i></span>
                <div>
                    <div class="section-title-monochrome">1. Maklumat Pemohon</div>
                    <div class="section-desc-monochrome">Referral & attendance</div>
                </div>
            </div>

            <div class="field-monochrome">
                <label>Nombor Rujukan</label>
                <input type="text" name="registration_officer" required value="{{ form_data.registration_officer|default:'' }}" placeholder="cth: XXX/0000">
            </div>

            <div class="field-monochrome">
                <label>Kehadiran Bersama</label>
                <select name="attended_with" required>
                    <option value="" disabled {% if not form_data.attended_with %}selected{% endif %}>— Pilih —</option>
                    <option value="PARENT" {% if form_data.attended_with == 'PARENT' %}selected{% endif %}>Dengan Ibu Bapa</option>
                    <option value="GUARDIAN" {% if form_data.attended_with == 'GUARDIAN' %}selected{% endif %}>Dengan Penjaga</option>
                </select>
            </div>

            <div style="margin-top: 20px;">
                <label style="font-size:0.8rem; font-weight:700; color:var(--gray-800); letter-spacing:0.5px; margin-bottom:12px; display:block;">PROGRAM DIPOHON</label>
                <div class="programme-grid-monochrome">
                    <div class="programme-tile-monochrome">
                        <input type="radio" id="mono_dip" name="applied_programme" value="Diploma" {% if form_data.applied_programme == 'Diploma' %}checked{% endif %}>
                        <label for="mono_dip"><i class="bi bi-mortarboard"></i> Diploma</label>
                    </div>
                    <div class="programme-tile-monochrome">
                        <input type="radio" id="mono_pra" name="applied_programme" value="Pra-Diploma" {% if form_data.applied_programme == 'Pra-Diploma' %}checked{% endif %}>
                        <label for="mono_pra"><i class="bi bi-book"></i> Pra-Diploma</label>
                    </div>
                    <div class="programme-tile-monochrome">
                        <input type="radio" id="mono_tvet" name="applied_programme" value="TVET" {% if form_data.applied_programme == 'TVET' %}checked{% endif %}>
                        <label for="mono_tvet"><i class="bi bi-tools"></i> TVET</label>
                    </div>
                    <div class="programme-tile-monochrome">
                        <input type="radio" id="mono_tahfiz" name="applied_programme" value="Smart Tahfiz" {% if form_data.applied_programme == 'Smart Tahfiz' %}checked{% endif %}>
                        <label for="mono_tahfiz"><i class="bi bi-moon-stars"></i> Smart Tahfiz</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 2: Maklumat Peribadi — DARK INSET FIELDS -->
        <div class="card-monochrome scan-sweep transmission-ripple">
            <div class="section-header-monochrome">
                <span class="section-icon-monochrome"><i class="bi bi-person-vcard"></i></span>
                <div><span class="section-title-monochrome">2. Maklumat Peribadi</span><div class="section-desc-monochrome">IDENTITY</div></div>
            </div>
            <div class="field-monochrome">
                <label>Nama Penuh</label>
                <input type="text" name="full_name" required value="{{ form_data.full_name|default:'' }}" placeholder="Seperti Kad Pengenalan">
            </div>
            <div class="field-monochrome">
                <label>No. Kad Pengenalan</label>
                <input type="text" name="ic_no" required value="{{ form_data.ic_no|default:'' }}" placeholder="000000-00-0000">
            </div>
            <div class="field-monochrome">
                <label>Jumlah Kredit SPM (optional)</label>
                <input type="number" name="spm_total_credit" value="{{ form_data.spm_total_credit|default:'0' }}" min="0">
            </div>
            <div class="field-monochrome">
                <label>Status Perkahwinan</label>
                <select name="marriage_status" required>
                    <option value="">— Pilih —</option>
                    <option value="Single" {% if form_data.marriage_status == 'Single' %}selected{% endif %}>Bujang</option>
                    <option value="Married" {% if form_data.marriage_status == 'Married' %}selected{% endif %}>Berkahwin</option>
                    <option value="Divorced" {% if form_data.marriage_status == 'Divorced' %}selected{% endif %}>Bercerai</option>
                </select>
            </div>
            <div class="field-monochrome">
                <label>Alamat Emel</label>
                <input type="email" name="email" required value="{{ form_data.email|default:'' }}" placeholder="nama@contoh.com">
            </div>
            <div class="field-monochrome">
                <label>Nombor Telefon</label>
                <input type="text" name="phone_no" required value="{{ form_data.phone_no|default:'' }}" placeholder="012-345 6789">
            </div>
        </div>

        <!-- SECTION 3: Alamat — DARK INSET FIELDS -->
        <div class="card-monochrome scan-sweep transmission-ripple">
            <div class="section-header-monochrome">
                <span class="section-icon-monochrome"><i class="bi bi-house"></i></span>
                <div><span class="section-title-monochrome">3. Alamat</span><div class="section-desc-monochrome">ADDRESS</div></div>
            </div>
            <div class="field-monochrome">
                <label>Alamat</label>
                <input type="text" name="address1" required>
            </div>
            <div class="field-monochrome">
                <label>Bandar</label>
                <input type="text" name="city" required>
            </div>
            <div class="field-monochrome">
                <label>Poskod</label>
                <input type="text" name="postcode" required>
            </div>
            <div class="field-monochrome">
                <label>Negeri</label>
                <select name="state" required>
                    <option value="">— Pilih Negeri —</option>
                    <option>Johor</option><option>Kedah</option><option>Kelantan</option><option>Melaka</option>
                    <option>Negeri Sembilan</option><option>Pahang</option><option>Perak</option><option>Perlis</option>
                    <option>Pulau Pinang</option><option>Sabah</option><option>Sarawak</option><option>Selangor</option>
                    <option>Terengganu</option><option>WP Kuala Lumpur</option><option>WP Labuan</option><option>WP Putrajaya</option>
                </select>
            </div>
        </div>

        <!-- SECTION 4: Maklumat Bapa — DARK INSET FIELDS -->
        <div class="card-monochrome scan-sweep transmission-ripple">
            <div class="section-header-monochrome">
                <span class="section-icon-monochrome"><i class="bi bi-person-standing"></i></span>
                <div><span class="section-title-monochrome">4. Maklumat Bapa</span><div class="section-desc-monochrome">FATHER / GUARDIAN</div></div>
            </div>
            <div class="field-monochrome">
                <label>Nama Penuh Bapa</label>
                <input type="text" name="father_name" required value="{{ form_data.father_name|default:'' }}">
            </div>
            <div class="field-monochrome">
                <label>No. Kad Pengenalan</label>
                <input type="text" name="father_ic" required value="{{ form_data.father_ic|default:'' }}">
            </div>
            <div class="field-monochrome">
                <label>Nombor Telefon</label>
                <input type="text" name="father_phone" required value="{{ form_data.father_phone|default:'' }}">
            </div>
            <div class="field-monochrome">
                <label>Pekerjaan</label>
                <input type="text" name="father_occupation" required value="{{ form_data.father_occupation|default:'' }}">
            </div>
            <div class="field-monochrome">
                <label>Anggaran Pendapatan (RM)</label>
                <input type="text" name="father_income" value="{{ form_data.father_income|default:'' }}">
            </div>
            
            <div style="margin-top: 16px;">
                <label style="font-size:0.8rem; font-weight:700; color:var(--gray-800);">BILANGAN TANGGUNGAN</label>
                <div class="dependants-monochrome">
                    <span><i class="bi bi-people"></i> Anak / tanggungan</span>
                    <input type="number" name="father_dependants" min="0" value="{{ form_data.father_dependants|default:'0' }}" placeholder="0">
                </div>
                <span style="font-size:0.65rem; color:var(--gray-500); margin-left:12px;">Termasuk anak dan keluarga terdekat</span>
            </div>
        </div>

        <!-- SECTION 5: Maklumat Ibu — DARK INSET FIELDS -->
        <div class="card-monochrome scan-sweep transmission-ripple">
            <div class="section-header-monochrome">
                <span class="section-icon-monochrome"><i class="bi bi-person-standing-dress"></i></span>
                <div><span class="section-title-monochrome">5. Maklumat Ibu</span><div class="section-desc-monochrome">MOTHER</div></div>
            </div>
            <div class="field-monochrome">
                <label>Nama Penuh Ibu</label>
                <input type="text" name="mother_name" required>
            </div>
            <div class="field-monochrome">
                <label>No. Kad Pengenalan</label>
                <input type="text" name="mother_ic" required>
            </div>
            <div class="field-monochrome">
                <label>Nombor Telefon</label>
                <input type="text" name="mother_phone" required>
            </div>
            <div class="field-monochrome">
                <label>Pekerjaan</label>
                <input type="text" name="mother_occupation" required>
            </div>
            <div class="field-monochrome">
                <label>Anggaran Pendapatan (RM)</label>
                <input type="text" name="mother_income">
            </div>
        </div>

        <!-- SECTION 6: Pilihan Program — DARK INSET FIELDS -->
        <div class="card-monochrome scan-sweep transmission-ripple">
            <div class="section-header-monochrome">
                <span class="section-icon-monochrome"><i class="bi bi-bookmark"></i></span>
                <div><span class="section-title-monochrome">6. Pilihan Program</span><div class="section-desc-monochrome">INTEREST (OPTIONAL)</div></div>
            </div>
            
            <div class="interest-stack-monochrome">
                <div class="interest-card-monochrome">
                    <h4><i class="bi bi-1-circle"></i> Pilihan Pertama</h4>
                    <textarea name="interest_choice1" rows="2" placeholder="cth: Diploma Kejuruteraan">{{ form_data.interest_choice1|default:'' }}</textarea>
                </div>
                <div class="interest-card-monochrome">
                    <h4><i class="bi bi-2-circle"></i> Pilihan Kedua</h4>
                    <textarea name="interest_choice2" rows="2">{{ form_data.interest_choice2|default:'' }}</textarea>
                </div>
                <div class="interest-card-monochrome">
                    <h4><i class="bi bi-3-circle"></i> Pilihan Ketiga</h4>
                    <textarea name="interest_choice3" rows="2">{{ form_data.interest_choice3|default:'' }}</textarea>
                </div>
            </div>
        </div>

        <!-- Error container -->
        <div id="error-container" style="margin: 0 20px;"></div>

        <!-- SUBMIT BUTTON — RAISED -->
        <div style="padding: 8px 20px 20px;">
            <button type="submit" class="btn-monochrome" id="submitBtn">
                <i class="bi bi-check2-circle"></i> Hantar
            </button>
            <p style="font-size:0.7rem; color:var(--gray-500); text-align:center; margin-top:16px; letter-spacing:0.5px;">
                SEMAK SEBELUM HANTAR · TIDAK BOLEH DIUBAH
            </p>
        </div>
    </form>

    <div class="brand-monochrome">
        <span class="signal-bar-mini" style="height: 16px;">
            <span></span><span></span><span></span><span></span><span></span>
        </span>
        AXIST
        <span class="signal-bar-mini" style="height: 16px;">
            <span></span><span></span><span></span><span></span><span></span>
        </span>
    </div>

    <script>
        (function(){
            "use strict";
            
            // ================================================
            // SMOOTH, NO-LAG TRANSITION FROM CHECK_IN TO SUCCESS
            // ================================================
            
            const form = document.getElementById('dataEntryForm');
            const submitBtn = document.getElementById('submitBtn');
            const errorContainer = document.getElementById('error-container');
            
            // Preload success page for instant transition
            let preloadedSuccess = null;
            function preloadSuccessPage() {
                fetch('/attsys/success/', { 
                    method: 'GET',
                    headers: { 'X-Requested-With': 'XMLHttpRequest' }
                })
                .then(response => response.text())
                .then(html => {
                    preloadedSuccess = html;
                    console.log('✓ Success page preloaded');
                })
                .catch(() => {
                    // Silently fail - not critical
                });
            }
            
            // Start preloading immediately
            preloadSuccessPage();
            
            // Dependants minimum
            const dep = document.querySelector('input[name="father_dependants"]');
            if(dep) dep.addEventListener('input', function(){ if(this.value<0) this.value=0; });

            // Phone formatting
            document.querySelectorAll('input[name="phone_no"], input[name="father_phone"], input[name="mother_phone"]').forEach(f=>{
                f.addEventListener('blur', function(){
                    let v=this.value.replace(/\D/g,'');
                    if(v.length===10) this.value=v.replace(/(\d{3})(\d{3})(\d{4})/,'$1-$2 $3');
                    else if(v.length===11) this.value=v.replace(/(\d{3})(\d{4})(\d{4})/,'$1-$2 $3');
                });
            });

            // IC formatting
            document.querySelectorAll('input[name="ic_no"], input[name="father_ic"], input[name="mother_ic"]').forEach(f=>{
                f.addEventListener('blur', function(){
                    let v=this.value.replace(/\D/g,'');
                    if(v.length===12) this.value=v.replace(/(\d{6})(\d{2})(\d{4})/,'$1-$2-$3');
                });
            });

            // ===== SMOOTH SUBMIT HANDLER =====
            form.addEventListener('submit', async function(e){
                e.preventDefault();
                
                // Clear previous errors
                errorContainer.innerHTML = '';
                
                // 1. FAST VALIDATION - show errors instantly
                let isValid = true;
                let firstInvalid = null;
                
                // Check required fields
                document.querySelectorAll('[required]').forEach(f => {
                    if(!f.value.trim() && f.type !== 'radio'){
                        f.classList.add('is-invalid');
                        isValid = false;
                        if (!firstInvalid) firstInvalid = f;
                    } else {
                        f.classList.remove('is-invalid');
                    }
                });

                // Check radio selection
                const radios = document.getElementsByName('applied_programme');
                const radioChecked = Array.from(radios).some(r => r.checked);
                if (!radioChecked) {
                    isValid = false;
                    document.querySelectorAll('.programme-tile-monochrome label').forEach(l => {
                        l.style.boxShadow = 'inset 6px 6px 12px rgba(0,0,0,0.2), inset -4px -4px 10px rgba(255,255,255,0.9), 0 0 0 2px #000000';
                    });
                } else {
                    document.querySelectorAll('.programme-tile-monochrome label').forEach(l => {
                        l.style.boxShadow = '';
                    });
                }

                // If validation fails, show error and scroll to first invalid field
                if (!isValid) {
                    errorContainer.innerHTML = '<div class="error-message"><i class="bi bi-exclamation-triangle"></i> Sila isi semua ruangan wajib.</div>';
                    if (firstInvalid) {
                        firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        firstInvalid.focus();
                    }
                    setTimeout(() => errorContainer.innerHTML = '', 3000);
                    return;
                }

                // 2. PRE-SUBMIT: Set loading state with haptic feedback simulation
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="bi bi-arrow-repeat spin"></i> MENGHANTAR... <span style="font-size:0.7rem; margin-left:8px; opacity:0.8;">TX·LOCK</span>';
                
                // Add spinner style
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
                    .spin { animation: spin 1s linear infinite; display: inline-block; }
                `;
                document.head.appendChild(style);

                // 3. COLLECT FORM DATA FAST
                // Set empty interests to dash
                ['interest_choice1','interest_choice2','interest_choice3'].forEach(n=>{
                    let inp = document.querySelector(`[name="${n}"]`);
                    if(inp && !inp.value.trim()) inp.value = '-';
                });
                
                const formData = new FormData(form);

                try {
                    // 4. INSTANT FEEDBACK: Add glitch effect on click
                    const glitch = document.createElement('div');
                    glitch.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.03);
                        pointer-events: none;
                        z-index: 99999;
                        animation: glitchFlash 0.15s ease-out;
                    `;
                    document.body.appendChild(glitch);
                    setTimeout(() => glitch.remove(), 150);

                    // 5. SUBMIT WITH FETCH - NO LAG
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 8000); // 8s timeout
                    
                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                        },
                        signal: controller.signal,
                        credentials: 'same-origin'
                    });
                    
                    clearTimeout(timeoutId);
                    
                    const data = await response.json();

                    if (data.success) {
                        // ===== INSTANT SUCCESS TRANSITION =====
                        // No delay, immediate visual feedback
                        
                        // 6. SHOW SUCCESS STATE ON BUTTON (75ms)
                        submitBtn.innerHTML = '<i class="bi bi-check2-circle"></i> DIHANTAR!';
                        submitBtn.style.background = '#1a1a1a';
                        submitBtn.style.transform = 'scale(0.98)';
                        
                        // 7. CLEAR FORM STORAGE (async, non-blocking)
                        setTimeout(() => {
                            try {
                                Object.keys(localStorage).forEach(key => {
                                    if (key.startsWith('form_')) localStorage.removeItem(key);
                                });
                                sessionStorage.clear();
                            } catch(e) {}
                        }, 10);

                        // 8. INSTANT PAGE TRANSITION - 120ms total from click to success page
                        setTimeout(() => {
                            if (preloadedSuccess) {
                                // Use preloaded HTML for instant render
                                document.write(preloadedSuccess);
                                document.close();
                            } else {
                                // Fallback: fetch then redirect
                                window.location.href = '/attsys/success/';
                            }
                        }, 50); // 50ms delay - just enough to see success state
                        
                    } else {
                        // Handle error
                        throw new Error(data.error || 'Submission failed');
                    }
                    
                } catch (error) {
                    console.error('Submission error:', error);
                    
                    // Restore button
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="bi bi-check2-circle"></i> Hantar';
                    
                    // Show error
                    let errorMsg = 'Ralat berlaku. Sila cuba lagi.';
                    if (error.name === 'AbortError') {
                        errorMsg = 'Masa tamat. Sila cuba lagi.';
                    } else if (error.message) {
                        errorMsg = error.message;
                    }
                    
                    errorContainer.innerHTML = `<div class="error-message"><i class="bi bi-exclamation-triangle"></i> ${errorMsg}</div>`;
                    setTimeout(() => errorContainer.innerHTML = '', 4000);
                    
                    // Remove spinner style
                    style.remove();
                }
            });

            // ===== PREVENT DOUBLE SUBMIT =====
            let submitting = false;
            form.addEventListener('submit', function() {
                if (submitting) {
                    e.preventDefault();
                    return false;
                }
                submitting = true;
                setTimeout(() => submitting = false, 5000);
            }, true);

            // ===== FREQUENCY SCAN EFFECT (keep original) =====
            document.addEventListener('click', function(e) {
                if (e.target.closest('button') || e.target.closest('.btn-monochrome')) {
                    // Quick flash effect (reduced from 200ms to 120ms)
                    const flash = document.createElement('div');
                    flash.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.02);
                        pointer-events: none;
                        z-index: 99999;
                        animation: quickFlash 0.12s ease-out;
                    `;
                    
                    if (!document.querySelector('#flashStyle')) {
                        const flashStyle = document.createElement('style');
                        flashStyle.id = 'flashStyle';
                        flashStyle.textContent = `
                            @keyframes quickFlash {
                                0% { opacity: 0; }
                                50% { opacity: 1; }
                                100% { opacity: 0; }
                            }
                        `;
                        document.head.appendChild(flashStyle);
                    }
                    
                    document.body.appendChild(flash);
                    setTimeout(() => flash.remove(), 120);
                }
            });

            // ===== FOCUS MANAGEMENT =====
            // Remove validation styling on focus
            document.querySelectorAll('input, select, textarea').forEach(field => {
                field.addEventListener('focus', function() {
                    this.classList.remove('is-invalid');
                });
            });

            // ===== INITIALIZE =====
            console.log('✓ Check-in form initialized with smooth transition');
            
        })();
    </script>
</body>
</html>