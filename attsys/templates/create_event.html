<!-- create_event.html - CLEAN VERSION -->
{% extends "base.html" %}

{% block title %}Create Event | ATTSYS{% endblock %}

{% block extra_css %}
<style>
    /* Create Event Page Specific Styles */
    .create-event-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 0 1.5rem;
    }
    
    .page-header {
        margin-bottom: 2rem;
        padding-top: 1rem;
    }
    
    .form-card {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        margin-bottom: 1.5rem;
    }
    
    .form-title {
        color: var(--dark);
        font-weight: 700;
        margin-bottom: 0.5rem;
        font-size: 1.75rem;
    }
    
    .form-subtitle {
        color: var(--gray-600);
        margin-bottom: 2rem;
        font-size: 1rem;
        line-height: 1.4;
    }
    
    .form-label {
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 0.5rem;
        display: block;
        font-size: 0.9rem;
    }
    
    .form-control, .form-select {
        border: 2px solid var(--gray-300);
        border-radius: 8px;
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
        transition: all 0.2s ease;
        background: white;
        width: 100%;
        box-sizing: border-box;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.15);
        outline: none;
    }
    
    .form-control::placeholder {
        color: var(--gray-500);
        font-size: 0.85rem;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-group-row-3 {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 1.5rem;
        align-items: start;
    }
    
    .btn-submit {
        background: linear-gradient(135deg, var(--dark) 0%, #343a40 100%);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.875rem 2rem;
        font-weight: 600;
        font-size: 0.95rem;
        width: 100%;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    
    .btn-submit:hover {
        background: linear-gradient(135deg, #343a40 0%, #212529 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
    }
    
    .btn-outline-dark {
        border: 2px solid var(--gray-300);
        border-radius: 8px;
        padding: 0.875rem 2rem;
        font-weight: 600;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
    }
    
    .btn-outline-dark:hover {
        background: var(--gray-50);
        border-color: var(--gray-400);
        transform: translateY(-2px);
    }
    
    .form-icon {
        color: var(--primary);
        margin-right: 0.5rem;
        font-size: 1rem;
        min-width: 20px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    
    .form-hint {
        font-size: 0.8rem;
        color: var(--gray-600);
        margin-top: 0.5rem;
        display: block;
        line-height: 1.3;
        font-style: italic;
    }
    
    .required::after {
        content: " *";
        color: #dc3545;
        font-weight: bold;
    }
    
    .form-actions {
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--gray-100);
    }
    
    /* Form Section Styling */
    .form-section {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--gray-100);
    }
    
    .form-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    
    .section-title {
        font-size: 1.15rem;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 1.25rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .section-title i {
        color: var(--primary);
        font-size: 1.1rem;
    }
    
    /* Custom State Input */
    .custom-state-container {
        margin-top: 1rem;
        padding: 1rem;
        background: var(--gray-50);
        border-radius: 8px;
        border: 1px solid var(--gray-300);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .create-event-container {
            padding: 0 1rem;
        }
        
        .form-card {
            padding: 1.25rem;
            border-radius: 8px;
        }
        
        .form-group-row-3 {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        .form-title {
            font-size: 1.5rem;
        }
        
        .form-subtitle {
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 1.05rem;
        }
        
        .btn-submit,
        .btn-outline-dark {
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
        }
        
        .form-control,
        .form-select {
            padding: 0.625rem 0.875rem;
        }
    }
    
    @media (max-width: 576px) {
        .form-card {
            padding: 1rem;
        }
        
        .page-header {
            margin-bottom: 1.5rem;
        }
        
        .form-title {
            font-size: 1.35rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="create-event-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="form-title">Create New Event</h1>
        <p class="form-subtitle">
            Set up a new event for attendance tracking, application forms, and real-time monitoring.
            Fill in the required details below.
        </p>
    </div>
    
    <!-- Form Card -->
    <div class="form-card">
        <form method="post" id="eventForm">
            {% csrf_token %}
            
            <!-- Event Information Section -->
            <div class="form-section">
                <h2 class="section-title">
                    <i class="bi bi-calendar-event"></i>
                    Event Information
                </h2>
                
                <!-- Event Title -->
                <div class="form-group">
                    <label class="form-label required">
                        <i class="bi bi-card-heading form-icon"></i>
                        Event Title
                    </label>
                    <input
                        type="text"
                        name="title"
                        class="form-control"
                        placeholder="Enter event title"
                        required
                        id="eventTitle"
                        maxlength="200"
                    >
                    <span class="form-hint">
                        Example: "Diploma Open Day 2024" or "Career Fair"
                    </span>
                </div>
                
                <!-- Event Description -->
                <div class="form-group">
                    <label class="form-label">
                        <i class="bi bi-card-text form-icon"></i>
                        Event Description (Optional)
                    </label>
                    <textarea
                        name="description"
                        class="form-control"
                        placeholder="Brief description of the event..."
                        rows="3"
                        id="eventDescription"
                        maxlength="500"
                    ></textarea>
                    <span class="form-hint">
                        Include agenda, speakers, or special instructions
                    </span>
                </div>
            </div>
            
            <!-- Event Location Section -->
            <div class="form-section">
                <h2 class="section-title">
                    <i class="bi bi-geo-alt"></i>
                    Event Location
                </h2>
                
                <!-- Venue Details -->
                <div class="form-group">
                    <label class="form-label required">
                        <i class="bi bi-building form-icon"></i>
                        Venue/Location
                    </label>
                    <input
                        type="text"
                        name="venue"
                        class="form-control"
                        placeholder="Enter venue name or physical location"
                        required
                        id="eventVenue"
                        maxlength="200"
                    >
                    <span class="form-hint">
                        Example: "Grand Ballroom, KL Convention Centre"
                    </span>
                </div>
                
                <!-- State Selection (Dropdown) -->
                <div class="form-group">
                    <label class="form-label required">
                        <i class="bi bi-map form-icon"></i>
                        State
                    </label>
                    <select
                        name="state"
                        class="form-select"
                        required
                        id="eventState"
                    >
                        <option value="" selected disabled>Select a state</option>
                        <option value="KUALA_LUMPUR">Kuala Lumpur</option>
                        <option value="SELANGOR">Selangor</option>
                        <option value="JOHOR">Johor</option>
                        <option value="PENANG">Penang</option>
                        <option value="PERAK">Perak</option>
                        <option value="SABAH">Sabah</option>
                        <option value="SARAWAK">Sarawak</option>
                        <option value="PAHANG">Pahang</option>
                        <option value="NEGERI_SEMBILAN">Negeri Sembilan</option>
                        <option value="KEDAH">Kedah</option>
                        <option value="KELANTAN">Kelantan</option>
                        <option value="TERENGGANU">Terengganu</option>
                        <option value="MELAKA">Melaka</option>
                        <option value="PERLIS">Perlis</option>
                        <option value="LABUAN">Labuan</option>
                        <option value="PUTRAJAYA">Putrajaya</option>
                        <option value="OTHER">Other</option>
                    </select>
                    <span class="form-hint">
                        Select the state where the event is located
                    </span>
                </div>
                
                <!-- Custom State Input (hidden by default) -->
                <div class="custom-state-container" id="customStateContainer" style="display: none;">
                    <div class="form-group">
                        <label class="form-label required">
                            <i class="bi bi-pencil form-icon"></i>
                            Specify State
                        </label>
                        <input
                            type="text"
                            name="custom_state"
                            class="form-control"
                            placeholder="Enter state name"
                            id="customStateInput"
                            maxlength="100"
                        >
                        <span class="form-hint">
                            Enter the state name (if not listed above)
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Event Schedule Section -->
            <div class="form-section">
                <h2 class="section-title">
                    <i class="bi bi-clock"></i>
                    Event Schedule
                </h2>
                
                <!-- Date and Time Row -->
                <div class="form-group-row-3">
                    <!-- Date -->
                    <div class="form-group">
                        <label class="form-label required">
                            <i class="bi bi-calendar-check form-icon"></i>
                            Event Date
                        </label>
                        <input
                            type="date"
                            name="date"
                            class="form-control"
                            required
                            id="eventDate"
                        >
                        <span class="form-hint">
                            Select event date
                        </span>
                    </div>
                    
                    <!-- Start Time -->
                    <div class="form-group">
                        <label class="form-label required">
                            <i class="bi bi-play-circle form-icon"></i>
                            Start Time
                        </label>
                        <input
                            type="time"
                            name="start_time"
                            class="form-control"
                            required
                            id="startTime"
                        >
                        <span class="form-hint">
                            Event begins
                        </span>
                    </div>
                    
                    <!-- End Time -->
                    <div class="form-group">
                        <label class="form-label required">
                            <i class="bi bi-stop-circle form-icon"></i>
                            End Time
                        </label>
                        <input
                            type="time"
                            name="end_time"
                            class="form-control"
                            required
                            id="endTime"
                        >
                        <span class="form-hint">
                            Event concludes
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Form Actions -->
            <div class="form-actions">
                <div class="d-flex gap-2">
                    <a href="{% url 'dashboard' %}" class="btn btn-outline-dark flex-fill">
                        <i class="bi bi-arrow-left me-1"></i>
                        Back to Dashboard
                    </a>
                    <button type="submit" class="btn-submit flex-fill">
                        <i class="bi bi-plus-circle"></i>
                        Create Event
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Elements
        const stateSelect = document.getElementById('eventState');
        const customStateContainer = document.getElementById('customStateContainer');
        const customStateInput = document.getElementById('customStateInput');
        const dateInput = document.getElementById('eventDate');
        
        // Set today's date as minimum and default
        const today = new Date();
        const formattedDate = today.toISOString().split('T')[0];
        dateInput.min = formattedDate;
        dateInput.value = formattedDate;
        
        // Set default times
        document.getElementById('startTime').value = '09:00';
        document.getElementById('endTime').value = '17:00';
        
        // Show/hide custom state input based on state selection
        stateSelect.addEventListener('change', function() {
            if (this.value === 'OTHER') {
                customStateContainer.style.display = 'block';
                customStateInput.required = true;
            } else {
                customStateContainer.style.display = 'none';
                customStateInput.required = false;
                customStateInput.value = '';
            }
        });
        
        // Date validation
        dateInput.addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (selectedDate < today) {
                alert('Event date cannot be in the past. Please select today or a future date.');
                this.value = formattedDate;
                this.focus();
            }
        });
        
        // Time validation
        function validateTimes() {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            
            if (startTime && endTime && startTime >= endTime) {
                alert('End time must be after start time.');
                document.getElementById('endTime').focus();
                return false;
            }
            return true;
        }
        
        document.getElementById('startTime').addEventListener('change', validateTimes);
        document.getElementById('endTime').addEventListener('change', validateTimes);
        
        // Form submission validation
        document.getElementById('eventForm').addEventListener('submit', function(e) {
            // Validate custom state if "Other" is selected
            if (stateSelect.value === 'OTHER' && !customStateInput.value.trim()) {
                e.preventDefault();
                alert('Please specify the state name.');
                customStateInput.focus();
                return false;
            }
            
            // Validate time order
            if (!validateTimes()) {
                e.preventDefault();
                return false;
            }
            
            // Simple loading state (just disable button)
            const submitBtn = this.querySelector('.btn-submit');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Creating...';
        });
        
        // Auto-focus event title
        document.getElementById('eventTitle').focus();
    });
</script>
{% endblock %}