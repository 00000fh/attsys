{% extends "base.html" %}

{% block title %}CREATE EVENT ¬∑ AXIST ¬∑ SIGNAL CORE{% endblock %}

{% block extra_css %}
<style>
    /* ---------------------------------------------------------------
       CREATE EVENT ‚Äî ASYMMETRIC HORIZONTAL ¬∑ SIGNAL INTENSITY v2
       White main, Black sub ¬∑ Oscilloscope heartbeat + Frequency waves
       
       > FIXED: Panel widths now stable regardless of content length
         - Form panel has fixed width calculation
         - Long text handled with truncation/wrapping
         - Dashboard panel maintains its size
    --------------------------------------------------------------- */

    :root {
        --black: #000000;
        --black-50: #171717;
        --black-100: #262626;
        --black-200: #404040;
        --black-300: #525252;
        --white: #ffffff;
        --white-50: #fafafa;
        --white-100: #f0f0f0;
        --white-200: #e5e5e5;
        --white-300: #d4d4d4;
        --gray-100: #f0f0f0;
        --gray-500: #737373;
        --gray-800: #2d2d2d;
        
        --neu-shadow-dark: #d1d5db;
        --neu-shadow-light: #ffffff;
        
        --neu-inset-dark: 
            inset 6px 6px 12px rgba(0, 0, 0, 0.2),
            inset -4px -4px 10px rgba(255, 255, 255, 0.9);
        
        --neu-inset-darker: 
            inset 8px 8px 16px rgba(0, 0, 0, 0.25),
            inset -6px -6px 12px rgba(255, 255, 255, 0.95);
    }

    /* ===== GLOBAL SIGNATURE: CRT + NOISE ===== */
    .create-signature-scan {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 1;
        background: repeating-linear-gradient(0deg, 
            rgba(0,0,0,0.01) 0px, 
            rgba(255,255,255,0.01) 1px,
            transparent 2px,
            transparent 4px
        );
        opacity: 0.2;
    }
    .create-heartbeat-pulse {
        position: fixed;
        bottom: 20px; left: 20px;
        width: 180px; height: 40px;
        background: rgba(0,0,0,0.02);
        border-left: 2px solid var(--black);
        border-right: 2px solid var(--black);
        border-radius: 2px;
        z-index: 5;
        opacity: 0.2;
        pointer-events: none;
        overflow: hidden;
    }
    .create-heartbeat-pulse::after {
        content: '';
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: linear-gradient(90deg, 
            transparent, 
            var(--black) 20%, 
            transparent 40%,
            var(--black) 60%,
            transparent 80%
        );
        animation: heartbeatMove 3s infinite linear;
        opacity: 0.2;
    }
    @keyframes heartbeatMove {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    /* ===== NEUROMORPHIC TOOLS ===== */
    .neu-raise-hard {
        background: linear-gradient(145deg, var(--white), var(--white-100));
        box-shadow: 12px 12px 24px rgba(0,0,0,0.04), -12px -12px 24px rgba(255,255,255,0.9);
        border: 1px solid rgba(0,0,0,0.02);
    }
    .neu-raise-soft {
        background: var(--white);
        box-shadow: 6px 6px 14px rgba(0,0,0,0.02), -6px -6px 14px rgba(255,255,255,0.7);
    }
    .neu-pressed {
        background: linear-gradient(145deg, var(--white-100), var(--white));
        box-shadow: inset 4px 4px 10px rgba(0,0,0,0.02), inset -4px -4px 10px rgba(255,255,255,0.5);
    }

    /* ===== HORIZONTAL ASYMMETRIC LAYOUT - FIXED WIDTHS ===== */
    .create-asymmetric {
        display: grid;
        grid-template-columns: minmax(0, 1.2fr) minmax(300px, 0.9fr);
        gap: 32px;
        align-items: start;
        position: relative;
        z-index: 30;
        width: 100%;
    }
    
    /* Ensure panels don't stretch beyond their grid columns */
    .form-panel,
    .signal-dashboard {
        min-width: 0;  /* Critical: allows content to shrink */
        width: 100%;
    }
    
    @media (max-width: 1000px) {
        .create-asymmetric { 
            grid-template-columns: 1fr; 
        }
    }

    /* ===== FORM PANEL ‚Äî WITH TEXT CONTAINMENT ===== */
    .form-panel {
        background: var(--white);
        border-radius: 32px;
        padding: 32px 32px 40px;
        border: 1px solid rgba(0,0,0,0.03);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        box-shadow: 16px 16px 28px rgba(0,0,0,0.08), -14px -14px 28px rgba(255,255,255,0.9);
        
        /* Text containment */
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
    }
    
    .form-panel::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--black), transparent);
        opacity: 0.2;
    }

    /* ===== SIGNAL DASHBOARD (RIGHT) ===== */
    .signal-dashboard {
        background: var(--white);
        border-radius: 32px;
        padding: 32px 28px;
        border: 1px solid var(--white-200);
        position: sticky;
        top: 100px;
        backdrop-filter: blur(8px);
        background: rgba(255,255,255,0.75);
        box-shadow: 8px 8px 20px rgba(0,0,0,0.02), -8px -8px 20px rgba(255,255,255,0.6);
        
        /* Ensure this panel also contains text */
        word-wrap: break-word;
        overflow-wrap: break-word;
    }

    /* ===== FORM FIELDS ===== */
    .field-signal {
        width: 100%;
        padding: 16px 20px;
        background: var(--white-100);
        border: none;
        border-radius: 24px;
        font-size: 0.95rem;
        color: var(--black-100);
        font-weight: 500;
        transition: 0.2s;
        
        box-shadow: 
            inset 6px 6px 12px rgba(0, 0, 0, 0.2),
            inset -4px -4px 10px rgba(255, 255, 255, 0.9);
        
        border: 1px solid rgba(0,0,0,0.02);
    }

    .field-signal:focus {
        outline: none;
        border: none;
        box-shadow: 
            inset 8px 8px 16px rgba(0, 0, 0, 0.25),
            inset -6px -6px 12px rgba(255, 255, 255, 0.95),
            0 0 0 3px rgba(0,0,0,0.02);
        background: var(--white-50);
    }

    .field-signal::placeholder {
        color: var(--gray-500);
        font-weight: 400;
        opacity: 0.8;
    }

    /* Select fields */
    select.field-signal {
        appearance: none;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>');
        background-repeat: no-repeat;
        background-position: right 20px center;
        background-size: 16px;
        background-color: var(--white-100);
    }

    /* Textarea */
    textarea.field-signal {
        background: var(--white-100);
        box-shadow: 
            inset 6px 6px 12px rgba(0, 0, 0, 0.2),
            inset -4px -4px 10px rgba(255, 255, 255, 0.9);
        resize: vertical;
        min-height: 80px;
        max-height: 200px;
    }

    .label-signal {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: var(--black-500);
        margin-bottom: 8px;
    }
    .label-signal i {
        font-size: 1rem;
        color: var(--black);
    }

    /* ===== TEXT CONTAINMENT FOR LONG CONTENT ===== */
    .text-truncate-container {
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .text-wrap-container {
        max-width: 100%;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
    }
    
    /* For the preview title specifically */
    #previewTitle {
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    /* For venue preview */
    #previewVenue {
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* ===== SIGNAL BARS ===== */
    .v-signal-bank {
        display: flex;
        flex-direction: column;
        gap: 6px;
        width: 100%;
    }
    .v-signal-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dashed rgba(0,0,0,0.05);
        gap: 12px;
    }
    .v-signal-row span:first-child {
        flex: 1;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .v-signal-meter {
        width: 100px;
        height: 8px;
        background: var(--white-200);
        border-radius: 4px;
        overflow: hidden;
        box-shadow: inset 1px 1px 3px rgba(0,0,0,0.05);
        flex-shrink: 0;
    }
    .v-signal-fill {
        height: 100%;
        background: var(--black);
        border-radius: 4px;
        transition: width 0.3s;
    }

    /* ===== TRANSMISSION RIPPLE ===== */
    .transmit-btn {
        background: var(--black);
        color: white;
        border: none;
        padding: 18px 36px;
        border-radius: 60px;
        font-weight: 700;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: 0.25s;
        box-shadow: 0 16px 28px rgba(0,0,0,0.25);
        width: 100%;
        letter-spacing: 2px;
        position: relative;
        overflow: hidden;
        
        /* Text containment */
        white-space: nowrap;
    }
    .transmit-btn span {
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .transmit-btn::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255,255,255,0.4);
        transform: translate(-50%, -50%);
        transition: width 0.4s, height 0.4s, opacity 0.4s;
    }
    .transmit-btn:hover::after {
        width: 200px;
        height: 200px;
        opacity: 0;
    }
    .transmit-btn:hover {
        background: var(--black-100);
        transform: scale(1.02);
        box-shadow: 0 22px 36px rgba(0,0,0,0.3);
    }

    /* ===== GLITCH EFFECT ===== */
    .glitch-mini {
        animation: glitchMini 2.5s infinite;
    }
    @keyframes glitchMini {
        0%, 100% { text-shadow: 0 0 0 black; }
        20% { text-shadow: -1px 0 0 rgba(0,0,0,0.2), 1px 0 0 rgba(0,0,0,0.2); }
        40% { text-shadow: 1px 0 0 rgba(0,0,0,0.2), -1px 0 0 rgba(0,0,0,0.2); }
    }

    /* ===== CUSTOM STATE ===== */
    .custom-state-active {
        margin-top: 20px;
        padding: 20px;
        background: var(--white-100);
        border-radius: 20px;
        border: 1px solid var(--black-300);
        animation: borderBlink 1.8s infinite;
        box-shadow: var(--neu-inset-dark);
    }
    @keyframes borderBlink {
        0% { border-color: rgba(0,0,0,0.2); }
        50% { border-color: rgba(0,0,0,0.7); }
        100% { border-color: rgba(0,0,0,0.2); }
    }

    /* ===== HINT BADGE ===== */
    .hint-badge {
        background: var(--white-50);
        border-radius: 40px;
        padding: 6px 16px;
        font-size: 0.7rem;
        border: 1px solid var(--white-200);
        color: var(--black-500);
        display: inline-flex;
        align-items: center;
        gap: 6px;
        box-shadow: inset 2px 2px 5px rgba(0,0,0,0.02), inset -2px -2px 5px rgba(255,255,255,0.7);
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    /* ===== FREQUENCY OSCILLATOR ===== */
    .osc-wave {
        width: 100%;
        height: 40px;
        background: repeating-linear-gradient(90deg, 
            var(--black) 0px, 
            var(--black) 2px, 
            transparent 2px, 
            transparent 8px
        );
        mask-image: linear-gradient(90deg, transparent, black, transparent);
        opacity: 0.3;
        flex-shrink: 0;
    }

    /* ===== VALIDATION STYLE ===== */
    .is-invalid {
        border: none !important;
        box-shadow: 
            inset 6px 6px 12px rgba(0, 0, 0, 0.2),
            inset -4px -4px 10px rgba(255, 255, 255, 0.9),
            0 0 0 2px var(--black) !important;
    }

    /* ===== TOP BANNER TEXT CONTAINMENT ===== */
    .top-banner-title {
        max-width: 500px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    @media (max-width: 768px) {
        .top-banner-title {
            max-width: 200px;
        }
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 640px) {
        .form-panel { padding: 24px; }
        .transmit-btn { 
            padding: 14px 24px;
            font-size: 0.9rem;
        }
        .create-asymmetric {
            gap: 20px;
        }
        .v-signal-row {
            flex-wrap: wrap;
        }
    }
    
    /* Ensure the main heading doesn't cause layout shift */
    h1.glitch-mini {
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    @media (min-width: 1280px) {
        h1.glitch-mini {
            max-width: 400px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- ===== BACKGROUND SIGNATURE ===== -->
<div class="create-signature-scan"></div>
<div class="create-heartbeat-pulse"></div>

<!-- ===== MAIN ASYMMETRIC GRID ===== -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-20">
    
    <!-- ===== TOP BANNER ‚Äî SIGNAL ID ===== -->
    <div class="flex justify-between items-center mb-8 reveal">
        <div class="flex items-center gap-4 min-w-0">  <!-- Added min-w-0 for flex shrinking -->
            <div class="neu-raise-hard w-14 h-14 rounded-2xl flex items-center justify-center relative flex-shrink-0">
                <i class="bi bi-broadcast text-black text-2xl"></i>
                <div class="absolute -bottom-1 -right-1 flex gap-[2px]">
                    <span class="w-1 h-3 bg-black rounded-full animate-pulse"></span>
                    <span class="w-1 h-4 bg-black rounded-full animate-pulse" style="animation-delay:0.2s"></span>
                    <span class="w-1 h-5 bg-black rounded-full animate-pulse" style="animation-delay:0.4s"></span>
                </div>
            </div>
            <div class="min-w-0">  <!-- Allow text to shrink/truncate -->
                <h1 class="text-4xl font-black text-black tracking-tight flex items-center gap-3 top-banner-title">
                    <span class="glitch-mini">CREATE</span> EVENT
                    <span class="text-xs font-mono bg-black text-white px-3 py-1.5 rounded-full flex-shrink-0">ENCRYPTED</span>
                </h1>
                <div class="flex items-center gap-4 mt-1 flex-wrap">
                    <span class="hint-badge"><i class="bi bi-shield-check"></i> CARRIER: 104.7 MHz</span>
                    <span class="hint-badge"><i class="bi bi-droplet"></i> SIGNAL LOCK</span>
                </div>
            </div>
        </div>
        <a href="{% url 'dashboard' %}" 
           class="group flex items-center gap-2 px-5 py-3 rounded-full border border-black-200 text-black-600 hover:bg-black hover:text-white transition-all duration-300 bg-white/50 flex-shrink-0">
            <i class="bi bi-arrow-left-short group-hover:-translate-x-1 transition-transform"></i>
            <span class="text-sm font-medium">RETURN</span>
        </a>
    </div>

    <!-- ===== ASYMMETRIC HORIZONTAL FORM ===== -->
    <form method="post" id="eventForm" class="create-asymmetric" novalidate>
        {% csrf_token %}
        
        <!-- ========== LEFT: MAIN FORM PANEL ========== -->
        <div class="form-panel neu-raise-hard">
            <!-- hidden oscillator line -->
            <div class="osc-wave mb-6"></div>
            
            <!-- SECTION: BASIC PARAMETERS -->
            <div class="flex items-center gap-3 mb-7">
                <div class="w-9 h-9 rounded-xl neu-pressed flex items-center justify-center flex-shrink-0">
                    <i class="bi bi-1-circle text-black"></i>
                </div>
                <span class="text-xs font-mono text-black-400 tracking-[0.2em] whitespace-nowrap">BASIC CARRIER</span>
            </div>

            <!-- Event Title ‚Äî with proper containment -->
            <div class="mb-7">
                <label class="label-signal required-star">
                    <i class="bi bi-megaphone"></i> EVENT TITLE
                </label>
                <input type="text" name="title" id="eventTitle" 
                       class="field-signal" 
                       placeholder="e.g. Future Leaders Summit" 
                       required maxlength="200" autocomplete="off">
                <div class="mt-2 flex items-center gap-2 text-black-300 text-xs flex-wrap">
                    <i class="bi bi-info-circle flex-shrink-0"></i>
                    <span class="text-wrap-container">Be specific. Max 200 characters.</span>
                </div>
            </div>

            <!-- Description -->
            <div class="mb-7">
                <label class="label-signal">
                    <i class="bi bi-file-earmark-text"></i> DESCRIPTION / FREQ
                </label>
                <textarea name="description" id="eventDescription" 
                          class="field-signal" rows="3" 
                          placeholder="Add agenda, speakers, or signal notes..."></textarea>
            </div>

            <!-- SECTION DIVIDER ‚Äî LOCATION -->
            <div class="flex items-center gap-3 my-8">
                <div class="w-9 h-9 rounded-xl neu-pressed flex items-center justify-center flex-shrink-0">
                    <i class="bi bi-2-circle text-black"></i>
                </div>
                <span class="text-xs font-mono text-black-400 tracking-[0.2em] whitespace-nowrap">GEOLOCK</span>
                <div class="flex-1 border-t border-dashed border-black-200 min-w-[20px]"></div>
            </div>

            <!-- Venue -->
            <div class="mb-7">
                <label class="label-signal required-star">
                    <i class="bi bi-pin-map"></i> VENUE
                </label>
                <input type="text" name="venue" id="eventVenue" 
                       class="field-signal" 
                       placeholder="Main Hall, KLCC" 
                       required maxlength="200">
            </div>

            <!-- State + Custom State -->
            <div class="mb-6">
                <label class="label-signal required-star">
                    <i class="bi bi-map"></i> STATE
                </label>
                <select name="state" id="eventState" class="field-signal" required>
                    <option value="" selected disabled>‚Äî Select state ‚Äî</option>
                    <option value="KUALA_LUMPUR">Kuala Lumpur</option>
                    <option value="SELANGOR">Selangor</option>
                    <option value="JOHOR">Johor</option>
                    <option value="PENANG">Penang</option>
                    <option value="PERAK">Perak</option>
                    <option value="SABAH">Sabah</option>
                    <option value="SARAWAK">Sarawak</option>
                    <option value="PAHANG">Pahang</option>
                    <option value="NEGERI_SEMBILAN">Negeri Sembilan</option>
                    <option value="KEDAH">Kedah</option>
                    <option value="KELANTAN">Kelantan</option>
                    <option value="TERENGGANU">Terengganu</option>
                    <option value="MELAKA">Melaka</option>
                    <option value="PERLIS">Perlis</option>
                    <option value="LABUAN">Labuan</option>
                    <option value="PUTRAJAYA">Putrajaya</option>
                    <option value="OTHER">‚úß Other State (specify)</option>
                </select>

                <!-- Custom State Container -->
                <div id="customStateContainer" class="custom-state-active" style="display: none;">
                    <label class="label-signal required-star">
                        <i class="bi bi-pencil-square"></i> SPECIFY STATE
                    </label>
                    <input type="text" name="custom_state" id="customStateInput" 
                           class="field-signal" placeholder="Enter state name" maxlength="100">
                </div>
            </div>

            <!-- SECTION DIVIDER ‚Äî TIME VECTOR -->
            <div class="flex items-center gap-3 my-8">
                <div class="w-9 h-9 rounded-xl neu-pressed flex items-center justify-center flex-shrink-0">
                    <i class="bi bi-3-circle text-black"></i>
                </div>
                <span class="text-xs font-mono text-black-400 tracking-[0.2em] whitespace-nowrap">TIME VECTOR</span>
                <div class="flex-1 border-t border-dashed border-black-200 min-w-[20px]"></div>
            </div>

            <!-- Date & Time Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-5">
                <div class="min-w-0">
                    <label class="label-signal required-star"><i class="bi bi-calendar"></i> DATE</label>
                    <input type="date" name="date" id="eventDate" class="field-signal" required>
                </div>
                <div class="min-w-0">
                    <label class="label-signal required-star"><i class="bi bi-play-fill"></i> START</label>
                    <input type="time" name="start_time" id="startTime" class="field-signal" required>
                </div>
                <div class="min-w-0">
                    <label class="label-signal required-star"><i class="bi bi-stop-fill"></i> END</label>
                    <input type="time" name="end_time" id="endTime" class="field-signal" required>
                </div>
            </div>
            <div class="mt-3 hint-badge">
                <i class="bi bi-clock-history"></i> End must be > start
            </div>

            <!-- TRANSMIT BUTTON -->
            <div class="mt-12">
                <button type="submit" class="transmit-btn" id="submitBtn">
                    <i class="bi bi-send-plus flex-shrink-0"></i>
                    <span class="truncate">ENCODE & TRANSMIT</span>
                    <i class="bi bi-arrow-right-short text-xl flex-shrink-0"></i>
                </button>
                <div class="flex justify-between mt-4 flex-wrap gap-2">
                    <span class="text-[10px] font-mono text-black-300 whitespace-nowrap">‚èé Ctrl+S to encode</span>
                    <span class="text-[10px] font-mono text-black-300 whitespace-nowrap">SIGNAL: <span id="signalStrengthVal">64%</span></span>
                </div>
            </div>
        </div> <!-- END LEFT PANEL -->

        <!-- ========== RIGHT: SIGNAL DASHBOARD ========== -->
        <div class="signal-dashboard neu-raise-soft">
            <!-- Live preview card -->
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-2 min-w-0">
                    <i class="bi bi-radio text-black text-xl flex-shrink-0"></i>
                    <span class="font-mono text-sm font-bold text-black truncate">SCOPE</span>
                </div>
                <div class="flex gap-1 flex-shrink-0">
                    <span class="w-2 h-2 bg-black rounded-full animate-ping"></span>
                    <span class="w-2 h-2 bg-black rounded-full animate-ping" style="animation-delay:0.3s"></span>
                    <span class="w-2 h-2 bg-black rounded-full animate-ping" style="animation-delay:0.6s"></span>
                </div>
            </div>

            <!-- PREVIEW BLOCK -->
            <div class="neu-pressed rounded-3xl p-5 mb-7">
                <div id="previewTitle" class="text-xl font-extrabold text-black truncate" title="[Event Title]">[Event Title]</div>
                <div class="flex items-center gap-2 mt-2 text-black-500 text-sm min-w-0">
                    <i class="bi bi-geo-alt flex-shrink-0"></i>
                    <span id="previewVenue" class="truncate" title="Venue not set">Venue not set</span>
                </div>
                <div class="flex items-center gap-3 mt-3 text-xs font-mono text-black-400 flex-wrap">
                    <span class="flex items-center gap-1 min-w-0"><i class="bi bi-calendar3 flex-shrink-0"></i> <span id="previewDate" class="truncate">‚Äî</span></span>
                    <span class="flex items-center gap-1 min-w-0"><i class="bi bi-clock flex-shrink-0"></i> <span id="previewTime" class="truncate">‚Äî</span></span>
                </div>
                <div class="mt-4 pt-3 border-t border-white-200 flex justify-between items-center">
                    <span class="text-black-400 text-xs">STATUS</span>
                    <span class="bg-black/5 text-black-700 px-4 py-1.5 rounded-full text-xs border border-black/10 flex items-center gap-1.5 whitespace-nowrap">
                        <span class="w-2 h-2 bg-amber-500 rounded-full animate-pulse"></span> DRAFT
                    </span>
                </div>
            </div>

            <!-- SIGNAL STRENGTH METER -->
            <div class="mb-7">
                <div class="flex justify-between items-center mb-3">
                    <span class="label-signal"><i class="bi bi-bar-chart"></i> TRANSMISSION dB</span>
                    <span id="signalPercent" class="text-lg font-bold font-mono text-black">64%</span>
                </div>
                <div class="w-full h-4 bg-white-200 rounded-full overflow-hidden neu-pressed">
                    <div id="signalMeter" class="h-full bg-black rounded-full transition-all duration-300" style="width: 64%;"></div>
                </div>
                <div class="flex justify-between mt-2 text-[0.6rem] font-mono text-black-400 tracking-wider">
                    <span>WEAK</span>
                    <span>MOD</span>
                    <span>LOCK</span>
                    <span>CRIT</span>
                </div>
            </div>

            <!-- VERTICAL SIGNAL BANK -->
            <div class="v-signal-bank">
                <div class="v-signal-row">
                    <span class="text-xs font-medium text-black-600 truncate" title="TITLE"><i class="bi bi-check-circle"></i> TITLE</span>
                    <div class="v-signal-meter"><div id="meterTitle" class="v-signal-fill" style="width: 0%"></div></div>
                </div>
                <div class="v-signal-row">
                    <span class="text-xs font-medium text-black-600 truncate" title="VENUE"><i class="bi bi-pin"></i> VENUE</span>
                    <div class="v-signal-meter"><div id="meterVenue" class="v-signal-fill" style="width: 0%"></div></div>
                </div>
                <div class="v-signal-row">
                    <span class="text-xs font-medium text-black-600 truncate" title="STATE"><i class="bi bi-map"></i> STATE</span>
                    <div class="v-signal-meter"><div id="meterState" class="v-signal-fill" style="width: 0%"></div></div>
                </div>
                <div class="v-signal-row">
                    <span class="text-xs font-medium text-black-600 truncate" title="DATE/TIME"><i class="bi bi-calendar"></i> DATE/TIME</span>
                    <div class="v-signal-meter"><div id="meterTime" class="v-signal-fill" style="width: 0%"></div></div>
                </div>
            </div>

            <!-- TIP / FREQUENCY HINT -->
            <div class="mt-8 bg-black/5 rounded-2xl p-4 border border-white-200 flex gap-3">
                <i class="bi bi-shield-lock text-black text-xl flex-shrink-0"></i>
                <div class="text-xs text-black-600 min-w-0">
                    <span class="font-bold text-black block truncate">ENCRYPTED SIGNAL</span>
                    <span class="block text-wrap-container">All fields marked * are carrier-locked. Preview updates in real time.</span>
                </div>
            </div>
            
            <!-- Mini frequency badge -->
            <div class="mt-5 flex justify-end">
                <span class="bg-white border border-black-200 rounded-full px-4 py-2 text-[10px] font-mono flex items-center gap-1 truncate max-w-full">
                    <span class="w-1.5 h-1.5 bg-green-600 rounded-full flex-shrink-0"></span> 
                    <span class="truncate">LIVE FEED ¬∑ 104.7 MHz</span>
                </span>
            </div>
        </div> <!-- END RIGHT DASHBOARD -->
    </form>
</div>

<script>
    (function(){
        'use strict';

        // ----- DOM elements -----
        const form = document.getElementById('eventForm');
        const submitBtn = document.getElementById('submitBtn');
        
        const title = document.getElementById('eventTitle');
        const venue = document.getElementById('eventVenue');
        const stateSelect = document.getElementById('eventState');
        const customContainer = document.getElementById('customStateContainer');
        const customInput = document.getElementById('customStateInput');
        const dateInput = document.getElementById('eventDate');
        const startTime = document.getElementById('startTime');
        const endTime = document.getElementById('endTime');

        // preview
        const previewTitle = document.getElementById('previewTitle');
        const previewVenue = document.getElementById('previewVenue');
        const previewDate = document.getElementById('previewDate');
        const previewTime = document.getElementById('previewTime');

        // meters
        const meterTitle = document.getElementById('meterTitle');
        const meterVenue = document.getElementById('meterVenue');
        const meterState = document.getElementById('meterState');
        const meterTime = document.getElementById('meterTime');
        const signalMeter = document.getElementById('signalMeter');
        const signalPercent = document.getElementById('signalPercent');
        const signalStrengthVal = document.getElementById('signalStrengthVal');

        // ----- set defaults -----
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const formatDate = (d) => d.toISOString().split('T')[0];
        if (dateInput) {
            dateInput.min = formatDate(today);
            dateInput.value = formatDate(tomorrow);
        }
        if (startTime) startTime.value = '09:00';
        if (endTime) endTime.value = '17:00';

        // ----- custom state toggle -----
        if (stateSelect && customContainer) {
            stateSelect.addEventListener('change', function() {
                if (this.value === 'OTHER') {
                    customContainer.style.display = 'block';
                    customInput.required = true;
                } else {
                    customContainer.style.display = 'none';
                    customInput.required = false;
                    customInput.value = '';
                }
                updateAll();
            });
        }

        // ----- validation: end time > start time -----
        function validateTimes() {
            if (startTime?.value && endTime?.value && startTime.value >= endTime.value) {
                showToast('End time must be after start time', 'error');
                endTime?.focus();
                return false;
            }
            return true;
        }
        if (startTime) startTime.addEventListener('change', validateTimes);
        if (endTime) endTime.addEventListener('change', validateTimes);

        // ----- date validation -----
        if (dateInput) {
            dateInput.addEventListener('change', function() {
                const selected = new Date(this.value);
                const now = new Date(); now.setHours(0,0,0,0);
                if (selected < now) {
                    showToast('Event date cannot be in the past', 'error');
                    this.value = formatDate(tomorrow);
                }
                updateAll();
            });
        }

        // ----- update preview + meters + signal strength -----
        function updateAll() {
            // preview title - with truncation handling
            const titleValue = title?.value?.trim() || '[Signal Title]';
            if (previewTitle) {
                previewTitle.textContent = titleValue;
                previewTitle.title = titleValue; // Show full text on hover
            }
            
            // preview venue
            const venueValue = venue?.value?.trim() || 'Venue not set';
            if (previewVenue) {
                previewVenue.textContent = venueValue;
                previewVenue.title = venueValue;
            }
            
            // date/time preview
            if (previewDate) previewDate.textContent = dateInput?.value || '‚Äî';
            if (previewTime) previewTime.textContent = startTime?.value || '‚Äî';

            // ----- calculate signal strength (0-100) -----
            let strength = 20;
            if (title?.value?.length >= 5) strength += 15;
            if (title?.value?.length >= 15) strength += 10;
            if (venue?.value?.length >= 5) strength += 15;
            if (stateSelect?.value && stateSelect.value !== '') strength += 15;
            if (dateInput?.value) strength += 10;
            if (startTime?.value && endTime?.value) strength += 10;
            if (customInput?.value && stateSelect?.value === 'OTHER') strength += 5;
            strength = Math.min(98, Math.max(28, strength));

            // update main meter
            if (signalMeter) signalMeter.style.width = strength + '%';
            if (signalPercent) signalPercent.textContent = strength + '%';
            if (signalStrengthVal) signalStrengthVal.textContent = strength + '%';

            // individual meters
            if (meterTitle) {
                let t = title?.value?.length ? Math.min(20 + title.value.length * 2, 98) : 10;
                meterTitle.style.width = Math.min(t, 98) + '%';
            }
            if (meterVenue) {
                let v = venue?.value?.length ? Math.min(20 + venue.value.length * 2, 98) : 10;
                meterVenue.style.width = Math.min(v, 98) + '%';
            }
            if (meterState) {
                let s = (stateSelect?.value && stateSelect.value !== '') ? 80 : 15;
                if (stateSelect?.value === 'OTHER' && customInput?.value) s = 90;
                meterState.style.width = s + '%';
            }
            if (meterTime) {
                let tm = (dateInput?.value && startTime?.value && endTime?.value) ? 85 : 30;
                meterTime.style.width = tm + '%';
            }
        }

        // ----- toast (matching base) -----
        function showToast(msg, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed top-24 right-6 z-50 neu-raise-hard rounded-xl p-4 border-l-4 ${type === 'error' ? 'border-l-red-500' : 'border-l-blue-500'} bg-white max-w-sm shadow-xl`;
            toast.innerHTML = `<div class="flex items-start gap-3"><i class="bi ${type==='error'?'bi-exclamation-triangle text-red-600':'bi-info-circle text-blue-600'} flex-shrink-0"></i><span class="text-sm text-black-700 text-wrap-container">${msg}</span><button onclick="this.parentElement.parentElement.remove()" class="ml-auto text-black-400 flex-shrink-0"><i class="bi bi-x"></i></button></div>`;
            document.body.appendChild(toast);
            setTimeout(() => toast?.remove(), 4000);
        }

        // ----- form submission -----
        form?.addEventListener('submit', async function(e) {
            e.preventDefault();

            if (stateSelect?.value === 'OTHER' && !customInput?.value?.trim()) {
                showToast('Please specify the state name', 'error');
                customInput?.focus();
                return;
            }
            if (!validateTimes()) return;

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> ENCODING...';

            await new Promise(r => setTimeout(r, 700));
            this.submit();
        });

        // ----- attach listeners -----
        [title, venue, stateSelect, dateInput, startTime, endTime, customInput].forEach(el => {
            if (el) {
                el.addEventListener('input', updateAll);
                el.addEventListener('change', updateAll);
            }
        });

        // ----- keyboard shortcut -----
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                form?.requestSubmit();
            }
        });

        // ----- focus title -----
        if (title) title.focus();

        // ----- initial update -----
        updateAll();

        // ----- auto-save simulation -----
        let autoTimer;
        form?.addEventListener('input', () => {
            clearTimeout(autoTimer);
            autoTimer = setTimeout(() => {
                console.log('üì° Auto-save (sim)');
            }, 2000);
        });

        // ----- validation style removal on input -----
        document.querySelectorAll('.field-signal').forEach(field => {
            field.addEventListener('input', function() {
                this.classList.remove('is-invalid');
            });
        });
    })();
</script>
{% endblock %}